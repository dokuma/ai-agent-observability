apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "ai-agent-monitoring.configmapName" . }}
  labels:
    {{- include "ai-agent-monitoring.labels" . | nindent 4 }}
data:
  # LLM
  LLM_ENDPOINT: {{ .Values.externalServices.llm.endpoint | quote }}
  LLM_MODEL: {{ .Values.externalServices.llm.model | quote }}
  # Monitoring Stack
  PROMETHEUS_URL: {{ .Values.externalServices.prometheus.url | quote }}
  LOKI_URL: {{ .Values.externalServices.loki.url | quote }}
  GRAFANA_URL: {{ .Values.externalServices.grafana.url | quote }}
  # MCP Server URLs（Chart 内 Service DNS から自動構築）
  MCP_PROMETHEUS_URL: {{ printf "http://%s-prometheus-mcp:%d" (include "ai-agent-monitoring.fullname" .) (.Values.prometheusMcp.service.port | int) | quote }}
  MCP_LOKI_URL: {{ printf "http://%s-loki-mcp:%d" (include "ai-agent-monitoring.fullname" .) (.Values.lokiMcp.service.port | int) | quote }}
  MCP_GRAFANA_URL: {{ printf "http://%s-grafana-mcp:%d" .Release.Name (index .Values "grafana-mcp" "service" "port" | int) | quote }}
  # Agent
  MAX_ITERATIONS: {{ .Values.config.maxIterations | quote }}
  INVESTIGATION_TIMEOUT_SECONDS: {{ .Values.config.investigationTimeoutSeconds | quote }}
  CORS_ALLOWED_ORIGINS: {{ .Values.config.corsAllowedOrigins | quote }}
  # MCP Transport
  MCP_TRANSPORT: {{ .Values.config.mcpTransport | quote }}
  MCP_GRAFANA_TRANSPORT: {{ .Values.config.mcpGrafanaTransport | quote }}
  MCP_PROMETHEUS_TRANSPORT: {{ .Values.config.mcpPrometheusTransport | quote }}
  MCP_LOKI_TRANSPORT: {{ .Values.config.mcpLokiTransport | quote }}
  # MCP TLS
  MCP_USE_TLS: {{ .Values.config.mcpUseTls | quote }}
  MCP_VERIFY_SSL: {{ .Values.config.mcpVerifySsl | quote }}
  MCP_CA_BUNDLE: {{ .Values.config.mcpCaBundle | quote }}
  # Langfuse
  LANGFUSE_ENABLED: {{ .Values.externalServices.langfuse.enabled | quote }}
  LANGFUSE_BASE_URL: {{ .Values.externalServices.langfuse.baseUrl | quote }}
  # Prometheus MCP
  PROMETHEUS_MCP_SERVER_TRANSPORT: {{ .Values.config.prometheusMcpTransport | quote }}
  PROMETHEUS_MCP_BIND_HOST: {{ .Values.config.prometheusMcpBindHost | quote }}
  PROMETHEUS_MCP_BIND_PORT: {{ .Values.config.prometheusMcpBindPort | quote }}
  # Loki MCP
  SSE_PORT: {{ .Values.config.ssePort | quote }}
